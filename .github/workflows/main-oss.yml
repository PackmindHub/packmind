name: Main OSS CI/CD Pipeline

# ┌─────────────────────────────────────────────────────────────────┐
# │ GLOBAL CONFIGURATION                                            │
# │ To update Node.js version, change all occurrences below        │
# │ Current version: 22.17.0                                       │
# └─────────────────────────────────────────────────────────────────┘

on:
  push:
    branches: ['main']
    tags:
      - 'release/*'
  pull_request:
    branches: ['main']

jobs:
  # Stage 1: Build and Test OSS
  build-oss:
    uses: ./.github/workflows/build-oss.yml
    with:
      node-version: 22.17.0

  # Stage 2: Quality and Security Checks
  quality:
    needs: [ build-oss ]
    uses: ./.github/workflows/quality.yml
    with:
      node-version: 22.17.0
    secrets:
      GITGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN_API_KEY }}
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      PACKMIND_API_KEY: ${{ secrets.PACKMIND_API_KEY }}
      PACKMIND_API_KEY_V3: ${{ secrets.PACKMIND_API_KEY_V3 }}